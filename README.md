# System design социальный сети для курса по system design

## Функциональные требования

- Создание поста с описанием
- Указание локации в посте
- Прикрепление одной или нескольких фотографий к посту
- Оценивание и комментирование постов другими пользователями
- Подписка на других пользователей для отслеживания новостей
- Поиск популярных локаций
- Поиск постов с определенными локациями
- Просмотр ленты других путешественников и ленты пользователя, 
основанной на подписках в обратном хронологическом порядке
- Пользователь может просматривать кол-во лайков на посте

## Нефункциональные требования

- DAU = 10 000 000
- Аудитория стран СНГ
- Данные хранятся всегда
- Активность пользователей
  - В среднем каждый пользователь создает 5 постов в месяц
  - В среднем каждый пользователь просматривает 30 постов в день
  - В среднем каждый пользователь лайкает 15 постов в день
  - В среднем каждый пользователь читает 20 комментариев в день
  - В среднем каждый пользователь комментирует 5 постов в день
  - В среднем каждый пользователь ищет 10 постов в день
- Лимиты
  - Максимальное кол-во изображений, которое может добавить пользователь к посту - 10
  - Максимальный размер изображения - 500КБ
  - За один запрос пользователь получает 5 постов
  - За один запрос пользователь получает 5 комментариев
- Сезонность:
  - Нагрузка будет повышаться в сезон отпусков(летом и зимой) примерно на 30%
- Доступность системы
  - SLA: 99.90

## Расчет нагрузки

### Посты

**RPS**
```
Read = 10 000 000 * 6 / 86400 = 700
Write = 10 000 000 * 5 / 30 / 24 / 60 / 60 = 20
```

**Трафик**

**Модель данных**

| post        |
|-------------|
| post_id     |
| content     |
| author_id   |
| location_id |
| created_at  |

| attachment |
|------------|
| post_id    |
| object_url |


**Нагрузка(по сущности)**
```
Read = 240Б * 700 * 5 / 1000 = 840КБ/C
Write =  = 240Б * 20 / 1000 = 4КБ/С
```

**Нагрузка(по медиаданным)**
Если брать максимальный размер изображения и максимальное кол-во
изображений в посте(10), то получаются такие расчеты:
```
Read = 500KB * 700 * 5 * 10 = 18ГБ/С
Write = 500KB * 20 * 10 = 100МБ/С
```

### Лайки

**RPS**
```
Read(получаем только кол-во лайков на посте) = 10 000 000 * 6 / 86400 = 700
Write = 10 000 000 * 15 / 86400 = 1700
```

**Трафик**

**Модель данных**

| like       |
|------------|
| post_id    |
| liker_id   |

**Нагрузка**
```
Read = 16Б * 700 * 5 = 56КБ/C
Write = 16Б * 1700 / 1000 = 27КБ/С
```

### Комментарии

**RPS**
```
Read = 10 000 000 * 20 / 5 / 86400 = 460
Write = 10 000 000 * 5 / 86400 = 580
```

**Трафик**

**Модель данных**

| comment    |
|------------|
| comment_id |
| post_id    |
| author_id  |
| content    |
| created_at |

**Нагрузка**
```
Read = 132Б * 5 * 460 / 1000 = 300КБ/С
Write = 132Б * 580 / 1000 = 76КБ/С
```