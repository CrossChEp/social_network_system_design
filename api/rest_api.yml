openapi: 3.0.3
info:
  version: 1.0.0
  title: api социальный сети для курса по system design
paths:

  # Ручки связанные с постами
  /api/v1/posts:
    post:
      description: Создает пост

      parameters:
        - name: userID
          in: cookie

      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreatePostRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/posts/query:
    description: Получает список постов на основе переданных userIDs и locationIDs

    post:
      parameters:
        - name: userID
          in: cookie

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPostsRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetPostsResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/posts/${postId}:
    description: Обновляет контент поста
    patch:
      parameters:
        - name: userID
          in: cookie
        - name: postId
          in: path

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePostRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пост не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '403':
          description: У пользователя нет прав редактировать указанный пост
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/posts/{$postId}:
    description: Удаляет пост пользователя, используя ID поста

    delete:
      parameters:
        - name: userID
          in: cookie
        - name: postId
          in: path

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пост не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '403':
          description: У пользователя нет прав удалять указанный пост
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/posts/like/{$postId}:
    description: Ставит лайк на пост, используя ID поста

    patch:
      parameters:
        - name: userID
          in: cookie
        - name: postId
          in: path

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пост не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/posts/unlike/{$postId}:
    description: Убирает лайк с поста, используя ID поста

    patch:
      parameters:
        - name: userID
          in: cookie
        - name: postId
          in: path

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пост не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  # Ручки связанные с комментариями
  /api/v1/comments/${postId}:
    description: Оставляет комментарий к посту

    post:
      parameters:
        - name: userID
          in: cookie
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пост не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/comments:
    description: Получает комментарии к посту, используя список id постов

    post:
      parameters:
        - name: userID
          in: cookie
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetCommentsByPostIDsRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetCommentsByPostIDsResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пост не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/comments/{$commentId}:
    description: Обновляет контент комментария

    put:
      parameters:
        - name: userID
          in: cookie
        - name: commentId
          in: path

      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCommentRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный комментарий не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '403':
          description: У пользователя нет прав редактировать указанный комментарий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/comments/${commentId}:
    description: Удаляет комментарий

    delete:
      parameters:
        - name: userID
          in: cookie
        - name: commentId
          in: path

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный комментарий не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '403':
          description: У пользователя нет прав удалять текущий комментарий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  # Ручки связанные с пользователями
  /api/v1/users/own:
    description: Получает информацию о текущем авторизированном пользователе

    get:
      parameters:
        - name: userID
          in: cookie
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/users/{$userId}:
    description: Получает информацию о пользователе

    post:
      parameters:
        - name: userID
          in: cookie
        - name: userId
          in: path

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пользователь не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/users/followers:
    description: Получает всех подписчиков авторизованного пользователя

    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetFollowersRequest'
        required: true

      parameters:
        - name: userID
          in: cookie

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetFollowersResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/users/followees:
    description: Получает всех пользователей, на которых авторизованный пользовать подписан

    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetFolloweesRequest'
        required: true

      parameters:
        - name: userID
          in: cookie
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetFolloweesResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/users/follow/${userId}:
    description: Подписывает на пользователя

    post:
      parameters:
        - name: userID
          in: cookie
        - name: userId
          in: path

      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пользователь не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/users/unfollow/${userId}:
    description: Отписывает от пользователя

    delete:
      parameters:
        - name: userID
          in: cookie
        - name: userId
          in: path
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '404':
          description: Указанный пользователь не был найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  # Ручки связанные с локацией
  /api/v1/locations/popular:
    description: Получает список популярных локаций

    post:
      parameters:
        - name: userID
          in: cookie
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetPopularLocationsRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetPopularLocationsResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/locations/search:
    description: Получает список локаций по подтексту

    post:
      parameters:
        - name: userID
          in: cookie
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchLocationsRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchLocationResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  # Ручки связанные с лентой новостей пользователей, на которых пользователь подписан
  /api/v1/feed/own:
    description: Получает ленту новостей авторизованного пользователя, исходя из подписок

    post:
      parameters:
        - name: userID
          in: cookie
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetOwnFeedRequest'
        required: true
      responses:
        '200':
          description: Успешная операция
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetFeedResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/v1/feed/${userId}:
    description: Получает ленту новостей любого пользователя, исходя из его подписок

    post:
      parameters:
        - name: userID
          in: cookie
        - name: userId
          in: path
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetFeedRequest'
        required: true
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetFeedResponse'
        '500':
          description: Непредвиденная ошибка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: Пользователь не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: Неправильный формат входных данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  schemas:
    # Модели связанные с постом
    CreatePostRequest:
      type: object
      properties:
        content:
          type: string
        attachments:
          description: "Массив фотографий, не больше 10 элементов"
          type: array
        locationId:
          type: integer

    GetPostsRequest:
      type: object
      properties:
        locationIds:
          type: array
          items:
            type: integer
        userIds:
          type: array
          items:
            type: integer
        fromPostId:
          type: integer
        limitPerRequest:
          type: integer

    GetPostsResponse:
      type: array
      items:
        $ref: "#/components/schemas/Post"

    Post:
      type: object
      properties:
        authorId:
          type: integer
        content:
          type: string
        location:
          $ref: "#/components/schemas/Location"
        likesQuantity:
          type: integer
        commentsQuantity:
          type: integer
        createdAt:
          type: integer
        attachments:
          type: array
          items:
            type: string

    UpdatePostRequest:
      type: object
      properties:
        content:
          type: string
        locationId:
          type: integer

    # Модели, связанные с комментариями
    CreateCommentRequest:
      type: object
      properties:
        content:
          type: string

    GetCommentsByPostIDsRequest:
      type: object
      properties:
        postId:
          type: integer
        fromCommentId:
          type: integer
        limitPerRequest:
          type: integer

    GetCommentsByPostIDsResponse:
      type: array
      items:
        $ref: "#/components/schemas/GetCommentByPostIDs"

    GetCommentByPostIDs:
      type: object
      properties:
        commentId:
          type: integer
        authorId:
          type: integer
        content:
          type: string
        createdAt:
          description: timestamp
          type: integer

    UpdateCommentRequest:
      type: object
      properties:
        newContent:
          type: string

    # Модели, связанные с пользователем
    GetFollowersRequest:
      type: object
      properties:
        fromFollowerId:
          type: integer
        limitPerRequest:
          type: integer

    GetFollowersResponse:
      type: array
      items:
        $ref: "#/components/schemas/User"

    GetFolloweesRequest:
      type: object
      properties:
        fromFollowerId:
          type: integer
        limitPerRequest:
          type: integer

    GetFolloweesResponse:
      type: array
      items:
        $ref: "#/components/schemas/User"

    User:
      type: object
      properties:
        userId:
          type: number
        name:
          type: string
        surname:
          type: string
        patronymic:
          type: string
        email:
          type: string
        pfpUrl:
          type: string
        posts:
          type: array
          items:
            $ref: "#/components/schemas/Post"

    # Модели, связанные с локацией
    GetPopularLocationsRequest:
      type: object
      properties:
        fromLocationId:
          type: integer
        limitPerRequest:
          type: integer

    GetPopularLocationsResponse:
      type: array
      items:
        $ref: "#/components/schemas/PopularLocationResponse"

    PopularLocationResponse:
      type: object
      properties:
        locationId:
          type: integer
        name:
          type: string
        longitude:
          type: number
        latitude:
          type: number
        randomImages:
          type: array
          items:
            type: string

    SearchLocationsRequest:
      type: object
      properties:
        searchRequest:
          type: string
        fromLocationId:
          type: integer
        limitPerRequest:
          type: integer

    SearchLocationResponse:
      type: array
      items:
        $ref: "#/components/schemas/PopularLocationResponse"

    Location:
      type: object
      properties:
        name:
          type: integer
        longitude:
          type: number
        latitude:
          type: number

    # Модели, связанные с лентой
    GetOwnFeedRequest:
      type: object
      properties:
        fromPostId:
          type: integer
        limitPerRequest:
          type: integer

    GetFeedRequest:
      type: object
      properties:
        fromPostId:
          type: integer
        limitPerRequest:
          type: integer

    GetFeedResponse:
      type: array
      items:
        $ref: "#/components/schemas/Post"

    # Общие модели
    ApiResponse:
      type: object
      properties:
        message:
          type: string

    PostIDRequest:
      type: object
      properties:
        postId:
          type: integer